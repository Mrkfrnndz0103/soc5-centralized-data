"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},92761:e=>{e.exports=require("node:async_hooks")},73811:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>p,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var o=r(49303),a=r(88716),n=r(60670),i=r(76344),l=e([i]);i=(l.then?(await l)():l)[0];let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\phlspxuser\\Documents\\Mrkcde\\Ongoing\\soc5-internalTool\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=u,x="/api/auth/login/route";function p(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}s()}catch(e){s(e)}})},76344:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{POST:()=>c});var o=r(87070),a=r(75748),n=r(95456),i=r(69026),l=e([a,n]);[a,n]=l.then?(await l)():l;let u="shopeemobile-external.com,spxexpress.com".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean);function p(e){let t=e.split("@")[1]?.toLowerCase()||"";return t&&u.includes(t)}let c=(0,i.g)("/api/auth/login",async e=>{let t=await e.json().catch(()=>({})),r=t?.ops_id;if(!r)return o.NextResponse.json({error:"ops_id is required"},{status:400});if(r.includes("@")&&!p(r))return o.NextResponse.json({error:"Email domain is not allowed"},{status:403});let s=await (0,a.I)(`SELECT ops_id, name, role, email
     FROM users
     WHERE ops_id = $1 OR email = $1
     LIMIT 1`,[r]);if(0===s.rows.length)return o.NextResponse.json({error:"Invalid credentials"},{status:401});let i=s.rows[0];if(i.email&&!p(i.email))return o.NextResponse.json({error:"Email domain is not allowed"},{status:403});let{sessionId:l}=await (0,n.ed)(i.ops_id),u=o.NextResponse.json({user:{ops_id:i.ops_id,name:i.name,role:i.role,email:i.email}});return(0,n.Uj)(u,l),u});s()}catch(e){s(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,5456],()=>r(73811));module.exports=s})();